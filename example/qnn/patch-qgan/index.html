<!doctype html>
<!-- This site was created with Hugo Blox. https://hugoblox.com -->
<!-- Last Published: January 25, 2025 --><html lang="en-us" dir="ltr"
      data-wc-theme-default="system">
  
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="generator" content="Hugo Blox Builder 0.3.1" />

  
  












  
  
  
  
  
  

  

  
  
  
    
  
  <meta name="description" content="In this tutorial, we demonstrate how to implement a quantum patch GAN introduced in Chapter xxx for the generation of hand-written digit of five. The whole pipeline includes following steps:
Load and pre-process the dataset Build the classical discriminator Build the quantum generator Train the quantum patch GAN Visualize the generated images We begin by importing required libraries:
import torch import torch.nn as nn import torch.optim as optim from torch.utils.data import Dataset, DataLoader import numpy as np import matplotlib.pyplot as plt import pennylane as qml import math Step 1: Dataset Preparation We will use the Optical Recognition of Handwritten Digits dataset, where each data point represents an $8\times 8$ grayscale image. Let’s start by defining a custom dataset class to load and process the data.
" />

  
  <link rel="alternate" hreflang="en-us" href="http://localhost:1313/example/qnn/patch-qgan/" />

  
  
  
  
    
    <link rel="stylesheet" href="/css/themes/blue.min.css" />
  

  
  
    
    <link href="/dist/wc.min.css" rel="stylesheet" />
  

  
  
  

  

  <script>
     
    window.hbb = {
       defaultTheme: document.documentElement.dataset.wcThemeDefault,
       setDarkTheme: () => {
        document.documentElement.classList.add("dark");
        document.documentElement.style.colorScheme = "dark";
      },
       setLightTheme: () => {
        document.documentElement.classList.remove("dark");
        document.documentElement.style.colorScheme = "light";
      }
    }

    console.debug(`Default Hugo Blox Builder theme is ${window.hbb.defaultTheme}`);

    if ("wc-color-theme" in localStorage) {
      localStorage.getItem("wc-color-theme") === "dark" ? window.hbb.setDarkTheme() : window.hbb.setLightTheme();
    } else {
      window.hbb.defaultTheme === "dark" ? window.hbb.setDarkTheme() : window.hbb.setLightTheme();
      if (window.hbb.defaultTheme === "system") {
        window.matchMedia("(prefers-color-scheme: dark)").matches ? window.hbb.setDarkTheme() : window.hbb.setLightTheme();
      }
    }
  </script>

  <script>
    
    document.addEventListener('DOMContentLoaded', function () {
      
      let checkboxes = document.querySelectorAll('li input[type=\'checkbox\'][disabled]');
      checkboxes.forEach(e => {
        e.parentElement.parentElement.classList.add('task-list');
      });

      
      const liNodes = document.querySelectorAll('.task-list li');
      liNodes.forEach(nodes => {
        let textNodes = Array.from(nodes.childNodes).filter(node => node.nodeType === 3 && node.textContent.trim().length > 1);
        if (textNodes.length > 0) {
          const span = document.createElement('label');
          textNodes[0].after(span);  
          span.appendChild(nodes.querySelector('input[type=\'checkbox\']'));
          span.appendChild(textNodes[0]);
        }
      });
    });
  </script>

  
  
  




































  
  

  
  <link rel="icon" type="image/png" href="/media/icon_hu13443689581201001649.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu6032917246960698308.png" />

  <link rel="canonical" href="http://localhost:1313/example/qnn/patch-qgan/" />

  
  
  
  
  
  
  
  
    
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary" />
  
  <meta property="og:site_name" content="Quantum Machine Learning Tutorial" />
  <meta property="og:url" content="http://localhost:1313/example/qnn/patch-qgan/" />
  <meta property="og:title" content="Quantum Patch GAN | Quantum Machine Learning Tutorial" />
  <meta property="og:description" content="In this tutorial, we demonstrate how to implement a quantum patch GAN introduced in Chapter xxx for the generation of hand-written digit of five. The whole pipeline includes following steps:

Load and pre-process the dataset
Build the classical discriminator
Build the quantum generator
Train the quantum patch GAN
Visualize the generated images

We begin by importing required libraries:
import torch
import torch.nn as nn
import torch.optim as optim
from torch.utils.data import Dataset, DataLoader

import numpy as np
import matplotlib.pyplot as plt
import pennylane as qml
import math
Step 1: Dataset Preparation
We will use the Optical Recognition of Handwritten Digits dataset, where each data point represents an $8\times 8$ grayscale image. Let’s start by defining a custom dataset class to load and process the data." /><meta property="og:image" content="http://localhost:1313/media/icon_hu6602121196246339203.png" />
    <meta property="twitter:image" content="http://localhost:1313/media/icon_hu6602121196246339203.png" /><meta property="og:locale" content="en-us" />
  
    
    
  

  



  


  <title>Quantum Patch GAN | Quantum Machine Learning Tutorial</title>

  
  
  
  
  
    
    
  
  
  <style>
    @font-face {
      font-family: 'Inter var';
      font-style: normal;
      font-weight: 100 900;
      font-display: swap;
      src: url(/dist/font/Inter.var.woff2) format(woff2);
    }
  </style>

  

  
  


  
  
  
  
  
  
  
  
  
    
      
      
        
        
          
        
          
        
          
        
          
        
          
        
        
        
      
    
  
  
  
  
  
  
  
  
  



















  
  
  
  
  
  
  
  <script
    defer
    src="/js/hugo-blox-en.min.js"
    integrity=""
  ></script>

  
  











</head>

  <body class="dark:bg-hb-dark dark:text-white page-wrapper" id="top">
    <div id="page-bg"></div>
    <div class="page-header ">
      
      
      
        
        
        
          <header id="site-header" class="header">
  <nav class="navbar px-3 flex justify-left">
    <div class="order-0 h-100">
      
      <a class="navbar-brand" href="/" title="Quantum Machine Learning Tutorial">
        
      </a>
    </div>
    
    <input id="nav-toggle" type="checkbox" class="hidden" />
    <label
      for="nav-toggle"
      class="order-3 cursor-pointer flex items-center lg:hidden text-dark dark:text-white lg:order-1">
      <svg id="show-button" class="h-6 fill-current block" viewBox="0 0 20 20">
        <title>Open Menu</title>
        <path d="M0 3h20v2H0V3z m0 6h20v2H0V9z m0 6h20v2H0V0z"></path>
      </svg>
      <svg id="hide-button" class="h-6 fill-current hidden" viewBox="0 0 20 20">
        <title>Close Menu</title>
        <polygon
          points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2"
          transform="rotate(45 10 10)"></polygon>
      </svg>
    </label>
    

    
    
    <ul
      id="nav-menu"
      class="navbar-nav order-3 hidden lg:flex w-full pb-6 lg:order-1 lg:w-auto lg:space-x-2 lg:pb-0 xl:space-x-8 justify-left
      ">
      
      
      
    </ul>

    <div class="order-1 ml-auto flex items-center md:order-2 lg:ml-0">

      
      
      

      
      
      <div class="px-3 text-black hover:text-primary-700 dark:text-white dark:hover:text-primary-300
            [&.active]:font-bold [&.active]:text-black/90 dark:[&.active]:text-white">
        <button class="theme-toggle mt-1" accesskey="t" title="appearance">
          <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
               stroke-linejoin="round" class="dark:hidden">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
          <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
               stroke-linejoin="round" class=" dark:block [&:not(dark)]:hidden">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
        </button>
      </div>
      

      
      

      
      
    </div>
  </nav>
</header>



        
      
    </div>
    <div class="page-body  my-10">
      <div class="mx-auto flex max-w-screen-xl">
  

  
  <div class="hb-sidebar-mobile-menu fixed inset-0 z-10 bg-white dark:bg-black/80 hidden"></div>



<aside class="hb-sidebar-container max-lg:[transform:translate3d(0,-100%,0)] lg:sticky">
  
  <div class="px-4 pt-4 lg:hidden">
    
    
  </div>
  <div class="hb-scrollbar lg:h-[calc(100vh-var(--navbar-height))]">
    <ul class="flex flex-col gap-1 lg:hidden">
      
      
        <li class=""><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/docs/"
    
  >Documentation
        <span data-hb-sidebar-toggle>
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-[18px] min-w-[18px] rounded-sm p-0.5 hover:bg-gray-800/5 dark:hover:bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="origin-center transition-transform rtl:-rotate-180"></path></svg>
        </span>
    </a><div class="ltr:pr-0 overflow-hidden">
        <ul class="hb-sidebar-list"><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/docs/getting-started/"
    
  >Getting Started
    </a>
              
            </li><li class="flex flex-col open"><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/docs/chapter2/"
    
  >Chapter2
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/docs/chapter3/"
    
  >Chapter3
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/docs/chapter4/"
    
  >Chapter4
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/docs/chapter5/"
    
  >Chapter5
    </a>
              
            </li></ul>
      </div></li>
        <li class="open"><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/example/"
    
  >Example
        <span data-hb-sidebar-toggle>
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-[18px] min-w-[18px] rounded-sm p-0.5 hover:bg-gray-800/5 dark:hover:bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="origin-center transition-transform rtl:-rotate-180"></path></svg>
        </span>
    </a><div class="ltr:pr-0 overflow-hidden">
        <ul class="hb-sidebar-list"><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/example/getting-started/"
    
  >Getting Started
    </a>
              
            </li><li class="flex flex-col open"><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/example/qnn/"
    
  >QNN
        <span data-hb-sidebar-toggle>
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-[18px] min-w-[18px] rounded-sm p-0.5 hover:bg-gray-800/5 dark:hover:bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="origin-center transition-transform rtl:-rotate-180"></path></svg>
        </span>
    </a>
              <div class="ltr:pr-0 overflow-hidden">
        <ul class="hb-sidebar-list"><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/example/qnn/classifier/"
    
  >Quantum Classifier
    </a>
              
            </li><li class="flex flex-col open"><a
    class="hb-sidebar-custom-link
      sidebar-active-item bg-primary-100 font-semibold text-primary-800 dark:bg-primary-300 dark:text-primary-900"
    href="/example/qnn/patch-qgan/"
    
  >Quantum Patch GAN
    </a>
  
    <ul class="hb-sidebar-mobile-toc"><li>
              <a
                href="#step-1-dataset-preparation"
                class="hb-docs-link"
              >Step 1: Dataset Preparation</a>
            </li>
          <li>
              <a
                href="#step-2-building-the-classical-discriminator"
                class="hb-docs-link"
              >Step 2: Building the Classical Discriminator</a>
            </li>
          <li>
              <a
                href="#step-3-defining-the-quantum-generator"
                class="hb-docs-link"
              >Step 3: Defining the Quantum Generator</a>
            </li>
          <li>
              <a
                href="#step-4-training-the-patch-quantum-gan"
                class="hb-docs-link"
              >Step 4: Training the Patch Quantum GAN</a>
            </li>
          <li>
              <a
                href="#step-5-visualizing-the-generated-images"
                class="hb-docs-link"
              >Step 5: Visualizing the Generated Images</a>
            </li>
          </ul>
  
              
            </li></ul>
      </div>
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/example/kernel/"
    
  >Quantum Kernel
        <span data-hb-sidebar-toggle>
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-[18px] min-w-[18px] rounded-sm p-0.5 hover:bg-gray-800/5 dark:hover:bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="origin-center transition-transform rtl:-rotate-180"></path></svg>
        </span>
    </a>
              <div class="ltr:pr-0 overflow-hidden">
        <ul class="hb-sidebar-list"><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/example/kernel/kernel-mnist/"
    
  >Classification on MNIST
    </a>
              
            </li></ul>
      </div>
            </li></ul>
      </div></li>
    </ul>

    <ul class="flex flex-col gap-1 max-lg:hidden">
        
        <li class=""><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/example/getting-started/"
    
  >Getting Started
    </a></li>
        <li class="open"><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/example/qnn/"
    
  >QNN
        <span data-hb-sidebar-toggle>
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-[18px] min-w-[18px] rounded-sm p-0.5 hover:bg-gray-800/5 dark:hover:bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="origin-center transition-transform rtl:-rotate-180"></path></svg>
        </span>
    </a><div class="ltr:pr-0 overflow-hidden">
        <ul class="hb-sidebar-list"><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/example/qnn/classifier/"
    
  >Quantum Classifier
    </a>
              
            </li><li class="flex flex-col open"><a
    class="hb-sidebar-custom-link
      sidebar-active-item bg-primary-100 font-semibold text-primary-800 dark:bg-primary-300 dark:text-primary-900"
    href="/example/qnn/patch-qgan/"
    
  >Quantum Patch GAN
    </a>
              
            </li></ul>
      </div></li>
        <li class=""><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/example/kernel/"
    
  >Quantum Kernel
        <span data-hb-sidebar-toggle>
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-[18px] min-w-[18px] rounded-sm p-0.5 hover:bg-gray-800/5 dark:hover:bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="origin-center transition-transform rtl:-rotate-180"></path></svg>
        </span>
    </a><div class="ltr:pr-0 overflow-hidden">
        <ul class="hb-sidebar-list"><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/example/kernel/kernel-mnist/"
    
  >Classification on MNIST
    </a>
              
            </li></ul>
      </div></li>
        
      </ul>
    </div>

</aside>
  

<nav class="hb-toc order-last hidden w-64 shrink-0 xl:block print:hidden px-4" aria-label="table of contents">
  











  <div class="hb-scrollbar text-sm [hyphens:auto] sticky top-16 overflow-y-auto pr-4 pt-6 max-h-[calc(100vh-var(--navbar-height)-env(safe-area-inset-bottom))] -mr-4 rtl:-ml-4"><p class="mb-4 font-semibold tracking-tight">On this page</p><ul>
      <li class="my-2 scroll-my-6 scroll-py-6">
        <a class="font-semibold inline-block text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 w-full break-words" href="#step-1-dataset-preparation">Step 1: Dataset Preparation</a>
      </li>
      <li class="my-2 scroll-my-6 scroll-py-6">
        <a class="font-semibold inline-block text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 w-full break-words" href="#step-2-building-the-classical-discriminator">Step 2: Building the Classical Discriminator</a>
      </li>
      <li class="my-2 scroll-my-6 scroll-py-6">
        <a class="font-semibold inline-block text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 w-full break-words" href="#step-3-defining-the-quantum-generator">Step 3: Defining the Quantum Generator</a>
      </li>
      <li class="my-2 scroll-my-6 scroll-py-6">
        <a class="pl-4 rtl:pr-4 inline-block text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 w-full break-words" href="#parameterized-quantum-circuit-pqc">Parameterized Quantum Circuit (PQC)</a>
      </li>
      <li class="my-2 scroll-my-6 scroll-py-6">
        <a class="pl-4 rtl:pr-4 inline-block text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 w-full break-words" href="#quantum-generator-circuit">Quantum Generator Circuit</a>
      </li>
      <li class="my-2 scroll-my-6 scroll-py-6">
        <a class="pl-4 rtl:pr-4 inline-block text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 w-full break-words" href="#quantum-patch-generator">Quantum Patch Generator</a>
      </li>
      <li class="my-2 scroll-my-6 scroll-py-6">
        <a class="font-semibold inline-block text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 w-full break-words" href="#step-4-training-the-patch-quantum-gan">Step 4: Training the Patch Quantum GAN</a>
      </li>
      <li class="my-2 scroll-my-6 scroll-py-6">
        <a class="pl-4 rtl:pr-4 inline-block text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 w-full break-words" href="#initializing-the-quantum-gan">Initializing the Quantum GAN</a>
      </li>
      <li class="my-2 scroll-my-6 scroll-py-6">
        <a class="pl-4 rtl:pr-4 inline-block text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 w-full break-words" href="#training-loop">Training Loop</a>
      </li>
      <li class="my-2 scroll-my-6 scroll-py-6">
        <a class="font-semibold inline-block text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 w-full break-words" href="#step-5-visualizing-the-generated-images">Step 5: Visualizing the Generated Images</a>
      </li></ul>

  
  
    
    
  



    












  </div>
  </nav>


  <article class="flex w-full min-w-0 min-h-[calc(100vh-var(--navbar-height))] justify-center break-words pb-8 pr-[calc(env(safe-area-inset-right)-1.5rem)]">
    <main class="prose prose-slate lg:prose-xl dark:prose-invert w-full min-w-0 max-w-6xl px-6 pt-4 md:px-12">
      <div class="mb-1">
        <div class="mt-1.5 flex items-center gap-1 overflow-hidden text-sm text-gray-500 dark:text-gray-400">
      <div class="whitespace-nowrap transition-colors min-w-[24px] overflow-hidden text-ellipsis hover:text-gray-900 dark:hover:text-gray-100">
        <a href="http://localhost:1313/example/">Example</a>
      </div><svg class="w-3.5 shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m8.25 4.5l7.5 7.5l-7.5 7.5"/></svg>
      <div class="whitespace-nowrap transition-colors min-w-[24px] overflow-hidden text-ellipsis hover:text-gray-900 dark:hover:text-gray-100">
        <a href="http://localhost:1313/example/qnn/">QNN</a>
      </div><svg class="w-3.5 shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m8.25 4.5l7.5 7.5l-7.5 7.5"/></svg><div class="whitespace-nowrap font-medium text-gray-700 dark:text-gray-100">Quantum Patch GAN</div>
</div>

      </div>

      <div class="content text-base">
        <h1>Quantum Patch GAN</h1>
        <p>In this tutorial, we demonstrate how to implement a quantum patch GAN introduced in Chapter xxx for the generation of hand-written digit of five. The whole pipeline includes following steps:</p>
<ol>
<li>Load and pre-process the dataset</li>
<li>Build the classical discriminator</li>
<li>Build the quantum generator</li>
<li>Train the quantum patch GAN</li>
<li>Visualize the generated images</li>
</ol>
<p>We begin by importing required libraries:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> torch
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> torch.nn <span style="color:#66d9ef">as</span> nn
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> torch.optim <span style="color:#66d9ef">as</span> optim
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> torch.utils.data <span style="color:#f92672">import</span> Dataset, DataLoader
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pennylane <span style="color:#66d9ef">as</span> qml
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> math
</span></span></code></pre></div><h2 id="step-1-dataset-preparation">Step 1: Dataset Preparation</h2>
<p>We will use the <a href="https://archive.ics.uci.edu/dataset/80/optical&#43;recognition&#43;of&#43;handwritten&#43;digits" target="_blank" rel="noopener">Optical Recognition of Handwritten Digits dataset</a>, where each data point represents an $8\times 8$ grayscale image. Let’s start by defining a custom dataset class to load and process the data.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OptdigitsData</span>(Dataset):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, data_path, label):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Dataset class for Optical Recognition of Handwritten Digits.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        super()<span style="color:#f92672">.</span>__init__()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>data <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> open(data_path, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> f<span style="color:#f92672">.</span>readlines():
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> int(line<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;,&#39;</span>)[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">==</span> label:
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e"># Normalize image pixel values from [0,16) to [0, 1)</span>
</span></span><span style="display:flex;"><span>                    image <span style="color:#f92672">=</span> [int(pixel)<span style="color:#f92672">/</span><span style="color:#ae81ff">16</span> <span style="color:#66d9ef">for</span> pixel <span style="color:#f92672">in</span> line<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;,&#39;</span>)[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]]
</span></span><span style="display:flex;"><span>                    image <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(image, dtype<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>float32)<span style="color:#f92672">.</span>reshape(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">8</span>)
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>append(image)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>label <span style="color:#f92672">=</span> label
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __len__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> len(self<span style="color:#f92672">.</span>data)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __getitem__(self, index):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> torch<span style="color:#f92672">.</span>from_numpy(self<span style="color:#f92672">.</span>data[index]), self<span style="color:#f92672">.</span>label
</span></span></code></pre></div><p>After defining the dataset class, we visualize a few examples to better understand the structure of the dataset.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">visualize_dataset</span>(data_path):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Visualizes the dataset by displaying examples for each digit label.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">10</span>):
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>, i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> OptdigitsData(data_path, label<span style="color:#f92672">=</span>i)
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>imshow(data[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>], cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gray&#39;</span>)
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Label: </span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>axis(<span style="color:#e6db74">&#39;off&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>show()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>visualize_dataset(<span style="color:#e6db74">&#39;code/chapter5_qnn/optical+recognition+of+handwritten+digits/optdigits.tra&#39;</span>)
</span></span></code></pre></div><h2 id="step-2-building-the-classical-discriminator">Step 2: Building the Classical Discriminator</h2>
<p>The discriminator is a classical neural network responsible for distinguishing real images from fake ones. It consists of fully connected layers with ReLU activations. The output is re-scaled into (0,1) via the Sigmoid function to be a reasonable indicator whether the input image is real or fake.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClassicalDiscriminator</span>(nn<span style="color:#f92672">.</span>Module):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    A classical discriminator for classifying real and fake images.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, input_shape):
</span></span><span style="display:flex;"><span>        super()<span style="color:#f92672">.</span>__init__()
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>model <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>Sequential(
</span></span><span style="display:flex;"><span>            nn<span style="color:#f92672">.</span>Flatten(),
</span></span><span style="display:flex;"><span>            nn<span style="color:#f92672">.</span>Linear(int(np<span style="color:#f92672">.</span>prod(input_shape)), <span style="color:#ae81ff">256</span>),
</span></span><span style="display:flex;"><span>            nn<span style="color:#f92672">.</span>ReLU(),
</span></span><span style="display:flex;"><span>            nn<span style="color:#f92672">.</span>Dropout(),
</span></span><span style="display:flex;"><span>            nn<span style="color:#f92672">.</span>Linear(<span style="color:#ae81ff">256</span>, <span style="color:#ae81ff">128</span>),
</span></span><span style="display:flex;"><span>            nn<span style="color:#f92672">.</span>ReLU(),
</span></span><span style="display:flex;"><span>            nn<span style="color:#f92672">.</span>Dropout(),
</span></span><span style="display:flex;"><span>            nn<span style="color:#f92672">.</span>Linear(<span style="color:#ae81ff">128</span>, <span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>            nn<span style="color:#f92672">.</span>Sigmoid()
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">forward</span>(self, img):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>model(img)
</span></span></code></pre></div><h2 id="step-3-defining-the-quantum-generator">Step 3: Defining the Quantum Generator</h2>
<p>The quantum generator is responsible for generating patches of images using parameterized quantum circuits (PQC). Each patch is constructed using a quantum circuit with trainable parameters.</p>
<h3 id="parameterized-quantum-circuit-pqc">Parameterized Quantum Circuit (PQC)</h3>
<p>The PQC applies layers of single-qubit rotation gates and entangling gates to the input qubits.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">PQC</span>(params):
</span></span><span style="display:flex;"><span>    n_layer, n_qubit <span style="color:#f92672">=</span> params<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>], params<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(n_layer):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(n_qubit):
</span></span><span style="display:flex;"><span>            qml<span style="color:#f92672">.</span>Rot(params[i, j, <span style="color:#ae81ff">0</span>], params[i, j, <span style="color:#ae81ff">1</span>], params[i, j, <span style="color:#ae81ff">2</span>], wires<span style="color:#f92672">=</span>j)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Control Z gates</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(n_qubit <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>            qml<span style="color:#f92672">.</span>CZ(wires<span style="color:#f92672">=</span>[j, j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>])
</span></span></code></pre></div><h3 id="quantum-generator-circuit">Quantum Generator Circuit</h3>
<p>This quantum generator circuit (sub-generator) converts the latent variable $\bm{z}$ into the latent quantum state $\ket{\bm{z}}$, applies the PQC, conducts partial measurements on the aucillary system $\mathcal{A}$, and returns the probabilities of each computational basis of the remaining system as the generated pixel values.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">QuantumGenerator</span>(params, z<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, n_qubit_a<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>    n_qubit <span style="color:#f92672">=</span> params<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># angle encoding of latent state z</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(n_qubit):
</span></span><span style="display:flex;"><span>        qml<span style="color:#f92672">.</span>RY(z[i], wires<span style="color:#f92672">=</span>i)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    PQC(params)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># partial measurement on the ancillary qubits</span>
</span></span><span style="display:flex;"><span>    qml<span style="color:#f92672">.</span>measure(wires<span style="color:#f92672">=</span>n_qubit<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> qml<span style="color:#f92672">.</span>probs(wires<span style="color:#f92672">=</span>range(n_qubit<span style="color:#f92672">-</span>n_qubit_a))
</span></span></code></pre></div><h3 id="quantum-patch-generator">Quantum Patch Generator</h3>
<p>With the sub-generators, the quantum patch generator combines outputed patches from multiple sub-generators to generate the whole image.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PatchQuantumGenerator</span>(nn<span style="color:#f92672">.</span>Module):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Combines patches generated by quantum circuits into full images.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, qnode_generator, n_generator, n_qubit, n_qubit_a, n_layer):
</span></span><span style="display:flex;"><span>        super()<span style="color:#f92672">.</span>__init__()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>params_generator <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>ParameterList([
</span></span><span style="display:flex;"><span>            nn<span style="color:#f92672">.</span>Parameter(torch<span style="color:#f92672">.</span>rand((n_layer, n_qubit, <span style="color:#ae81ff">3</span>)), requires_grad<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n_generator)
</span></span><span style="display:flex;"><span>        ])
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>qnode_generator <span style="color:#f92672">=</span> qnode_generator
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>n_qubit_a <span style="color:#f92672">=</span> n_qubit_a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">forward</span>(self, zs):
</span></span><span style="display:flex;"><span>        images <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> z <span style="color:#f92672">in</span> zs:
</span></span><span style="display:flex;"><span>            patches <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> params <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>params_generator:
</span></span><span style="display:flex;"><span>                patch <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>qnode_generator(params, z<span style="color:#f92672">=</span>z, n_qubit_a<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>n_qubit_a)<span style="color:#f92672">.</span>float()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># post-processing: min-max scaling</span>
</span></span><span style="display:flex;"><span>                patch <span style="color:#f92672">=</span> (patch <span style="color:#f92672">-</span> patch<span style="color:#f92672">.</span>min()) <span style="color:#f92672">/</span> (patch<span style="color:#f92672">.</span>max() <span style="color:#f92672">-</span> patch<span style="color:#f92672">.</span>min() <span style="color:#f92672">+</span> <span style="color:#ae81ff">1e-8</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                patches<span style="color:#f92672">.</span>append(patch<span style="color:#f92672">.</span>unsqueeze(<span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>            patches <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>cat(patches, dim<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            images<span style="color:#f92672">.</span>append(patches<span style="color:#f92672">.</span>flatten()<span style="color:#f92672">.</span>unsqueeze(<span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> torch<span style="color:#f92672">.</span>cat(images, dim<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span></code></pre></div><h2 id="step-4-training-the-patch-quantum-gan">Step 4: Training the Patch Quantum GAN</h2>
<h3 id="initializing-the-quantum-gan">Initializing the Quantum GAN</h3>
<p>We initialize the quantum generator and classical discriminator along with their optimizers.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Hyperparameters</span>
</span></span><span style="display:flex;"><span>torch<span style="color:#f92672">.</span>manual_seed(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>image_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>image_height <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>n_generator <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>n_qubit_d <span style="color:#f92672">=</span> int(np<span style="color:#f92672">.</span>log2((image_width <span style="color:#f92672">*</span> image_height) <span style="color:#f92672">//</span> n_generator))
</span></span><span style="display:flex;"><span>n_qubit_a <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>n_qubit <span style="color:#f92672">=</span> n_qubit_d <span style="color:#f92672">+</span> n_qubit_a
</span></span><span style="display:flex;"><span>n_layer <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Quantum device</span>
</span></span><span style="display:flex;"><span>dev <span style="color:#f92672">=</span> qml<span style="color:#f92672">.</span>device(<span style="color:#e6db74">&#34;lightning.qubit&#34;</span>, wires<span style="color:#f92672">=</span>n_qubit)
</span></span><span style="display:flex;"><span>qnode_generator <span style="color:#f92672">=</span> qml<span style="color:#f92672">.</span>QNode(QuantumGenerator, dev)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initialize generator and discriminator</span>
</span></span><span style="display:flex;"><span>discriminator <span style="color:#f92672">=</span> ClassicalDiscriminator([image_height, image_width])
</span></span><span style="display:flex;"><span>discriminator<span style="color:#f92672">.</span>train()
</span></span><span style="display:flex;"><span>generator <span style="color:#f92672">=</span> PatchQuantumGenerator(qnode_generator, n_generator, n_qubit, n_qubit_a, n_layer)
</span></span><span style="display:flex;"><span>generator<span style="color:#f92672">.</span>train()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Optimizers</span>
</span></span><span style="display:flex;"><span>lr_generator <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>
</span></span><span style="display:flex;"><span>lr_discriminator <span style="color:#f92672">=</span> <span style="color:#ae81ff">1e-2</span>
</span></span><span style="display:flex;"><span>opt_discriminator <span style="color:#f92672">=</span> optim<span style="color:#f92672">.</span>SGD(discriminator<span style="color:#f92672">.</span>parameters(), lr<span style="color:#f92672">=</span>lr_discriminator)
</span></span><span style="display:flex;"><span>opt_generator <span style="color:#f92672">=</span> optim<span style="color:#f92672">.</span>SGD(generator<span style="color:#f92672">.</span>parameters(), lr<span style="color:#f92672">=</span>lr_generator)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Construct dataset and dataloader</span>
</span></span><span style="display:flex;"><span>batch_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>dataset <span style="color:#f92672">=</span> OptdigitsData(<span style="color:#e6db74">&#39;code/chapter5_qnn/optical+recognition+of+handwritten+digits/optdigits.tra&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>dataloader <span style="color:#f92672">=</span> DataLoader(dataset, batch_size<span style="color:#f92672">=</span>batch_size, shuffle<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, drop_last<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Loss function</span>
</span></span><span style="display:flex;"><span>loss_fn <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>BCELoss()
</span></span><span style="display:flex;"><span>labels_real <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>ones(batch_size, dtype<span style="color:#f92672">=</span>torch<span style="color:#f92672">.</span>float)
</span></span><span style="display:flex;"><span>labels_fake <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>zeros(batch_size, dtype<span style="color:#f92672">=</span>torch<span style="color:#f92672">.</span>float)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Testing setup</span>
</span></span><span style="display:flex;"><span>n_test <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>z_test <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>rand(n_test, n_qubit) <span style="color:#f92672">*</span> math<span style="color:#f92672">.</span>pi
</span></span></code></pre></div><h3 id="training-loop">Training Loop</h3>
<p>The GAN is trained using alternating updates for the discriminator and the generator. The generator learns to produce images that fool the discriminator. We save the generated images every epoch to record the behaviour of the generator during training.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>n_epoch <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>record <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(n_epoch):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> data, _ <span style="color:#f92672">in</span> dataloader:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        zs <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>rand(batch_size, n_qubit) <span style="color:#f92672">*</span> math<span style="color:#f92672">.</span>pi
</span></span><span style="display:flex;"><span>        image_fake <span style="color:#f92672">=</span> generator(zs)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Training the discriminator</span>
</span></span><span style="display:flex;"><span>        discriminator<span style="color:#f92672">.</span>zero_grad()
</span></span><span style="display:flex;"><span>        pred_fake <span style="color:#f92672">=</span> discriminator(image_fake<span style="color:#f92672">.</span>detach())
</span></span><span style="display:flex;"><span>        pred_real <span style="color:#f92672">=</span> discriminator(data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        loss_discriminator <span style="color:#f92672">=</span> loss_fn(pred_fake<span style="color:#f92672">.</span>squeeze(), labels_fake) <span style="color:#f92672">+</span> loss_fn(pred_real<span style="color:#f92672">.</span>squeeze(), labels_real)
</span></span><span style="display:flex;"><span>        loss_discriminator<span style="color:#f92672">.</span>backward()
</span></span><span style="display:flex;"><span>        opt_discriminator<span style="color:#f92672">.</span>step()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Training the generator</span>
</span></span><span style="display:flex;"><span>        generator<span style="color:#f92672">.</span>zero_grad()
</span></span><span style="display:flex;"><span>        pred_fake <span style="color:#f92672">=</span> discriminator(image_fake)
</span></span><span style="display:flex;"><span>        loss_generator <span style="color:#f92672">=</span> loss_fn(pred_fake<span style="color:#f92672">.</span>squeeze(), labels_real)
</span></span><span style="display:flex;"><span>        loss_generator<span style="color:#f92672">.</span>backward()
</span></span><span style="display:flex;"><span>        opt_generator<span style="color:#f92672">.</span>step()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;The </span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">-th epoch: discriminator loss=</span><span style="color:#e6db74">{</span>loss_discriminator<span style="color:#e6db74">:</span><span style="color:#e6db74"> 0.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">, generator loss=</span><span style="color:#e6db74">{</span>loss_generator<span style="color:#e6db74">:</span><span style="color:#e6db74"> 0.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># test</span>
</span></span><span style="display:flex;"><span>    generator<span style="color:#f92672">.</span>eval()
</span></span><span style="display:flex;"><span>    image_generated <span style="color:#f92672">=</span> generator(z_test)<span style="color:#f92672">.</span>view(n_test, image_height, image_width)<span style="color:#f92672">.</span>detach()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    record[str(i)] <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;loss_discriminator&#39;</span>: loss_discriminator<span style="color:#f92672">.</span>item(),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;loss_generator&#39;</span>: loss_generator<span style="color:#f92672">.</span>item(),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;image_generated&#39;</span>: image_generated<span style="color:#f92672">.</span>numpy()<span style="color:#f92672">.</span>tolist()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    generator<span style="color:#f92672">.</span>train()
</span></span></code></pre></div><h2 id="step-5-visualizing-the-generated-images">Step 5: Visualizing the Generated Images</h2>
<p>After training, we can visualize the images generated by the quantum generator.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>n_epochs_to_visualize <span style="color:#f92672">=</span> len(record) <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>n_images_per_epoch <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig, axes <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(n_epochs_to_visualize, n_images_per_epoch, figsize<span style="color:#f92672">=</span>(n_images_per_epoch, n_epochs_to_visualize))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Iterate through the recorded epochs and visualize generated images</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> epoch_idx, (epoch, data) <span style="color:#f92672">in</span> enumerate(record<span style="color:#f92672">.</span>items()):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> epoch_idx <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>    images <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(data[<span style="color:#e6db74">&#39;image_generated&#39;</span>])
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> img_idx <span style="color:#f92672">in</span> range(n_images_per_epoch):
</span></span><span style="display:flex;"><span>        ax <span style="color:#f92672">=</span> axes[epoch_idx <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>, img_idx]
</span></span><span style="display:flex;"><span>        ax<span style="color:#f92672">.</span>imshow(images[img_idx], cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gray&#39;</span>)
</span></span><span style="display:flex;"><span>        ax<span style="color:#f92672">.</span>axis(<span style="color:#e6db74">&#39;off&#39;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Add epoch information to the title of each row</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> img_idx <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            ax<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Epoch </span><span style="color:#e6db74">{</span>epoch<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div>
      </div>

      <div class="mt-16"></div>
      
      
  
    
    
    
      
      
    
<div class="pt-1 no-prose w-full">
  <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
  <div class="flex flex-col md:flex-row flex-nowrap justify-between gap-5 pt-2">
    <div class="">
      
        <a class="group flex no-underline" href="/example/qnn/classifier/">
          <span
            class="mt-[-0.3rem] me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
          ><span class="ltr:inline rtl:hidden">&larr;</span></span>
          <span class="flex flex-col">
            <span
              class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
            >Quantum Classifier</span>
            <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
              
                Jan 1, 0001
              
            </span>
          </span>
        </a>
      
    </div>
    <div class="">
      
    </div>
  </div>
</div>



      



    </main>
  </article>
</div>

    </div>
    <div class="page-footer">
      <footer class="container mx-auto flex flex-col justify-items-center text-sm leading-6 mt-24 mb-4 text-slate-700 dark:text-slate-200">

  












  
  
  
  
  














  





  <p class="powered-by text-center">
    
    
    
      
      
      
      
      
      
      Published with <!-- raw HTML omitted -->Hugo Blox Builder<!-- raw HTML omitted --> — the free, <!-- raw HTML omitted -->open source<!-- raw HTML omitted --> website builder that empowers creators.
    
  </p>

</footer>

    </div>

    
    











  </body>
</html>
